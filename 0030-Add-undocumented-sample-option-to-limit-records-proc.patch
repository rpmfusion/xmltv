From 12fd70a6adf1b96846ae47d00d43b4ec1a3514c3 Mon Sep 17 00:00:00 2001
From: Honir <honir@c4b.co.uk>
Date: Mon, 28 Dec 2020 09:45:17 +0000
Subject: [PATCH 30/50] Add undocumented --sample option to limit records
 processed (for debugging use only)

---
 filter/tv_imdb | 14 +++++++++-----
 lib/IMDB.pm    |  5 +++++
 2 files changed, 14 insertions(+), 5 deletions(-)

diff --git a/filter/tv_imdb b/filter/tv_imdb
index 914a421b..b4f1eb8d 100755
--- a/filter/tv_imdb
+++ b/filter/tv_imdb
@@ -206,6 +206,7 @@ my ($opt_help,
 	$opt_num_actors,
 	$opt_validate_title,
 	$opt_validate_year,
+    $opt_sample,
    );
 
 GetOptions('help' 			=> \$opt_help,
@@ -222,6 +223,7 @@ GetOptions('help' 			=> \$opt_help,
 		'debug+'			=> \$opt_debug,
 		'validate-title=s'	=> \$opt_validate_title,
 		'validate-year=s'	=> \$opt_validate_year,
+	    'sample=s'  		=> \$opt_sample,
 		) or usage(0);
 
 usage(1) if $opt_help;
@@ -232,6 +234,7 @@ $opt_with_plot=0	 	if ( !defined($opt_with_plot) );
 $opt_num_actors=3		if ( !defined($opt_num_actors) );
 $opt_movies_only=0 		if ( !defined($opt_movies_only) );
 $opt_debug=0		 	if ( !defined($opt_debug) );
+$opt_sample=0        	if ( !defined($opt_sample) );
 
 $opt_quiet=(defined($opt_quiet));
 if ( !defined($opt_stats) ) {
@@ -266,11 +269,12 @@ END
 	}
 
 	my %options =
-		('imdbDir' => $opt_imdbDir,
-		 'verbose' => !$opt_quiet,
-		 'showProgressBar' => !$opt_quiet,
-		 'stageToRun' => $opt_prepStage,
-		 'downloadMissingFiles' => $opt_download,
+		('imdbDir' 					=> $opt_imdbDir,
+		 'verbose' 					=> !$opt_quiet,
+		 'showProgressBar' 			=> !$opt_quiet,
+		 'stageToRun' 				=> $opt_prepStage,
+		 'downloadMissingFiles' 	=> $opt_download,
+		 'sample' 					=> $opt_sample,
 		);
 
 	if ( $opt_prepStage eq "all" ) {
diff --git a/lib/IMDB.pm b/lib/IMDB.pm
index 123ceb03..f5d25a15 100644
--- a/lib/IMDB.pm
+++ b/lib/IMDB.pm
@@ -1653,6 +1653,7 @@ sub readMoviesOrGenres($$$$)
 		$lineCount++;
 		my $line=$_;
 		#print "read line $lineCount:$line\n";
+		last if ( $self->{sample} != 0 && $self->{sample} < $lineCount );	# undocumented option (used in debugging)
 
 		# end is line consisting of only '-'
 		last if ( $line=~m/^\-\-\-\-\-\-\-+/o );
@@ -1794,6 +1795,7 @@ sub readCastOrDirectors($$$)
 		my $line=$_;
 		$line=~s/\n$//o;
 		#$self->status("read line $lineCount:$line");
+		last if ( $self->{sample} != 0 && $self->{sample} < $lineCount );	# undocumented option (used in debugging)
 
 		# end is line consisting of only '-'
 		last if ( $line=~m/^\-\-\-\-\-\-\-+/o );
@@ -1948,6 +1950,7 @@ sub readRatings($$$$)
 		$lineCount++;
 		my $line=$_;
 		#print "read line $lineCount:$line";
+		last if ( $self->{sample} != 0 && $self->{sample} < $lineCount );	# undocumented option (used in debugging)
 
 		$line=~s/\n$//o;
 
@@ -2027,6 +2030,7 @@ sub readKeywords($$$$)
 	my $count=0;
 	while(<$fh>) {
 		$lineCount++;
+		last if ( $self->{sample} != 0 && $self->{sample} < $lineCount );	# undocumented option (used in debugging)
 		my $line=$_;
 		chomp($line);
 		next if ($line =~ m/^\s*$/);
@@ -2112,6 +2116,7 @@ sub readPlots($$$$)
 	my $count=0;
 	while(<$fh>) {
 		$lineCount++;
+		last if ( $self->{sample} != 0 && $self->{sample} < $lineCount );	# undocumented option (used in debugging)
 		my $line=$_;
 		chomp($line);
 		next if ($line =~ m/^\s*$/);
-- 
2.29.2

